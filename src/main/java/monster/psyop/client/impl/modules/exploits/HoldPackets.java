package monster.psyop.client.impl.modules.exploits;

import monster.psyop.client.framework.events.EventListener;
import monster.psyop.client.framework.modules.Categories;
import monster.psyop.client.framework.modules.Module;
import monster.psyop.client.impl.events.game.OnPacket;
import monster.psyop.client.utility.PacketUtils;
import net.minecraft.network.protocol.Packet;

import java.util.ArrayList;

public class HoldPackets extends Module {
    public static final ArrayList<Packet<?>> packets = new ArrayList<>();
    public static final Runnable flush = () -> {
        for (Packet<?> packet : packets) {
            PacketUtils.send(packet);
        }
        packets.clear();
    };

    public HoldPackets() {
        super(Categories.EXPLOITS, "hold-packets", "Queues up packets.", flush, flush);
    }

    @EventListener
    public void onPacketSend(OnPacket.Send event) {
        packets.add(event.packet());
        event.cancel();
    }
}
